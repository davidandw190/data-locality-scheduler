apiVersion: v1
kind: Pod
metadata:
  name: minio-direct-setup
  namespace: data-locality-scheduler
spec:
  containers:
  - name: mc
    image: minio/mc
    command: [ "/bin/sh", "-c" ]
    args:
    - |
      # Wait for MinIO to be ready
      echo "Waiting for MinIO service..."
      sleep 5
      until mc config host add myminio http://minio:9000 minioadmin minioadmin; do
        echo "Retrying MinIO connection..."
        sleep 5
      done

      # Create test buckets
      mc mb -p myminio/test-bucket
      mc mb -p myminio/results-bucket
      mc mb -p myminio/edge-bucket
      mc mb -p myminio/cloud-bucket

      # Create test data files
      echo '{"name":"test-data","content":"test data","size":1048576}' > /tmp/test-data.json
      echo '{"name":"edge-data","content":"edge data","size":1048576}' > /tmp/edge-data.json
      echo '{"name":"cloud-data","content":"cloud data","size":1048576}' > /tmp/cloud-data.json

      # Upload files
      mc cp /tmp/test-data.json myminio/test-bucket/
      mc cp /tmp/edge-data.json myminio/edge-bucket/
      mc cp /tmp/cloud-data.json myminio/cloud-bucket/

      # List objects
      echo "Listing buckets and objects:"
      mc ls myminio
      mc ls myminio/test-bucket

      echo "Setup complete"
      # Keep the pod running for a bit to review logs
      sleep 60
    resources:
      requests:
        cpu: "100m"
        memory: "128Mi"
      limits:
        cpu: "250m"
        memory: "256Mi"
  restartPolicy: Never
